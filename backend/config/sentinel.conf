# Redis Sentinel Configuration for Survey360 High Availability
# Monitors Redis master and handles automatic failover

# Sentinel port
port 26379
bind 127.0.0.1

# Working directory
dir /var/lib/redis

# Log file
logfile /var/log/redis/sentinel.log

# ======================
# MONITOR CONFIGURATION
# ======================
# sentinel monitor <master-name> <ip> <redis-port> <quorum>
# Quorum: minimum number of sentinels that must agree master is down
sentinel monitor survey360-master 127.0.0.1 6379 2

# Authentication for master
sentinel auth-pass survey360-master survey360_redis_secret_2026

# ======================
# FAILOVER SETTINGS
# ======================
# Time in milliseconds to consider master down (30 seconds)
sentinel down-after-milliseconds survey360-master 30000

# Number of replicas that can be reconfigured in parallel during failover
sentinel parallel-syncs survey360-master 1

# Failover timeout in milliseconds (3 minutes)
sentinel failover-timeout survey360-master 180000

# ======================
# NOTIFICATION SCRIPTS (Optional)
# ======================
# Script to run when failover happens
# sentinel notification-script survey360-master /app/backend/scripts/sentinel-notify.sh

# Script to reconfigure clients after failover
# sentinel client-reconfig-script survey360-master /app/backend/scripts/sentinel-reconfig.sh

# ======================
# SECURITY
# ======================
# Require password for Sentinel commands
requirepass survey360_sentinel_secret_2026

# Deny script execution
sentinel deny-scripts-reconfig yes
