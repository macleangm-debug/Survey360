<analysis>**original_problem_statement:**
The user provided a comprehensive Product Requirements Document (PRD) checklist for a Data Collection Module. The final instruction was to perform a gap analysis of the current system against this checklist and then implement all features identified as Missing or Partially Implemented.

**Key requirements from the PRD checklist include:**
- **Core Concepts:** Survey Instruments, Datasets (Lookup Tables), Case Management, Submissions (Interview Records), and Audit/Paradata.
- **Channels:** CAWI (Web), Token/Panel Surveys, CAPI (Offline Field Interviews), and CATI (Telephone Interviewing).
- **Collector App (Offline-First):** Must have a local encrypted DB, outbox queue, resumable sync, conflict resolution, case workflow management, and offline dataset search.
- **Advanced Form Logic:** Branching, validations, repeat groups, and preload/write-back functionality.
- **Quality Controls:** Audio audits, field audit trails (paradata), and a quality rules engine.
- **Monitoring Console:** Live data explorer, submission review panel, progress tracking, and a back-check module.
- **Data Workflow:** A governed data pipeline with a review/correction loop and versioning.
- **AI Functions:** Instrument QA, field simulation, and a monitoring assistant.
- **Extensibility:** A plugin/widget SDK for custom question types.
- **Security & Compliance:** Encryption at rest/transit, role-based access, and PII separation.

**User's preferred language**: English

**what currently exists?**
The agent has successfully scaffolded a significant portion of the application. This includes:
- **P1 Features:** Backend routes and frontend placeholder pages for Token Surveys, CATI Center, Back-check, and Preload/Write-back.
- **P2 Features:** Backend routes and a frontend placeholder page for Quality & AI Monitoring. Integration with an LLM was set up by adding  to the environment and installing the  library.
- **P3 Features:** Initial scaffolding for Offline-First CAPI (encryption hook, status indicator), a Plugin/Widget SDK (manager UI), and CAWI enhancements (backend routes, frontend page).
- **Form Builder:** The form builder UI was enhanced to include new field types for Barcode and Signature.
- **Bug Fixes:** Two critical issues were resolved: a CATI API route conflict and a missing  parameter in the forms API call.

Most of the created backend routes are stubs that return success messages, and the frontend pages are placeholders with empty states, ready to be built out.

**Last working item**:
-   **Last item agent was working:** The agent's final action was to analyze a comprehensive PRD checklist provided by the user, perform a gap analysis to identify missing and incomplete features, and receive the instruction to implement all of them. The next step is to begin this large-scale implementation.
-   **Status:** NOT STARTED
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** both
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
The primary task is to implement all features marked as Partial or Missing in the agent's gap analysis. This is a very large task encompassing most of the application's core logic.

-   **Issue 1: Implement Core Data Models & Logic (P0)**
    -   **Description:** The foundational concepts like Case Management, versioned Survey Instruments, and the full Submission lifecycle (draft, submitted, returned, approved, rejected) are marked as Missing. These are critical for the entire system to function.
    -   **Next debug checklist:**
        -   Backend: Define and implement MongoDB schemas/models for , , and  with state management.
        -   Backend: Create API endpoints to manage these core objects.
        -   Frontend: Build UI components to interact with these models.
    -   **Why fix this issue and what will be achieved with the fix?** This will build the core data backbone of the entire data collection platform as per the PRD.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** both

-   **Issue 2: Build Out Offline-First CAPI Functionality (P0)**
    -   **Description:** The current implementation is a skeleton. Key features like resumable sync with conflict resolution, an outbox queue, and full offline case/dataset management are Missing.
    -   **Next debug checklist:**
        -   Frontend (): Implement the logic for the outbox queue, partial uploads, retry policies, and conflict detection.
        -   Frontend (): Enhance the service worker for robust background sync.
        -   Frontend: Build the UI for enumerators to manage their assigned cases and access offline datasets as described in PRD section 4.2.
    -   **Why fix this issue and what will be achieved with the fix?** To deliver the True Offline-First CAPI experience, which is a core requirement.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** both

-   **Issue 3: Flesh out all P1, P2, and P3 Modules (P1)**
    -   **Description:** All major modules (CATI, Back-check, Preload, Quality AI, CAWI, Plugins) have placeholder UI and stubbed backend routes. They lack any real functionality.
    -   **Next debug checklist:**
        -   Go through each module one by one (e.g., , ).
        -   Implement the actual business logic for each feature as described in the PRD (e.g., call queues for CATI, discrepancy reports for Back-check, AI analysis for Quality Monitoring).
    -   **Why fix this issue and what will be achieved with the fix?** This will turn the scaffolded application into a functional product.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** both

**In progress Task List**:
-   **Task 1: Implement All Missing and Partially Implemented Features from PRD**
    -   **Where to resume:** Start by implementing the core data models (Issue 1 in the list above), as they are foundational. Then, proceed to the CAPI offline features (Issue 2), and finally, build out the business logic for all the modules (Issue 3).
    -   **What will be achieved with this?** The full realization of the product as specified in the PRD checklist.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** both
    -   **Blocked on something:** Nothing.

**Upcoming and Future Tasks**
The entire list of Missing and Partial items from the agent's gap analysis constitutes the upcoming work. The user has requested all of them to be implemented. Key items include:
-   **Core Concepts (P0):**
    -   Case Management Lifecycle (, , ).
    -   Immutable, versioned Survey Instruments.
    -   Full Submission state machine ( ->  ->  ->  / ).
-   **Offline CAPI (P0):**
    -   Resumable sync with conflict resolution.
    -   Offline case workflow and dataset lookup.
-   **Monitoring & Quality (P1):**
    -   Live Data Explorer with real-time feeds.
    -   Submission Review Panel to approve/reject/return submissions.
    -   Back-check module with discrepancy reporting.
    -   Quality Rules Engine (speeding, straight-lining).
-   **AI Functions (P2):**
    -   AI Instrument QA (predict time, detect confusing wording).
    -   AI Field Simulation for path testing.
    -   AI Monitoring Assistant for summarizing field status.
-   **Extensibility (P2):**
    -   Fully implement the Plugin/Widget SDK for custom question types.

**Completed work in this session**
- **Feature Scaffolding (P1):** Created backend routes and frontend pages for Token Surveys, CATI Center, Back-check, and Preload/Write-back.
- **Feature Scaffolding (P2):** Created backend routes and frontend page for Quality & AI Monitoring.
- **Feature Scaffolding (P3):** Created initial files for Offline CAPI, Plugin/Widget SDK, and CAWI Enhancements.
- **Form Builder Enhancement:** Added Barcode and Signature field types to the Form Builder UI ().
- **Bug Fix:** Corrected a route conflict in .
- **Bug Fix:** Updated the forms API () to correctly handle .
- **Configuration:** Added  to  for AI feature integration.
- **Documentation:** Updated  with completed features.

**Earlier issues found/mentioned but not fixed**
The user provided a detailed PRD at the end of the session. The agent's gap analysis revealed that a large number of required features are either missing or only partially implemented. These are not missed issues but rather the newly defined scope of work. The full list is captured in the Upcoming and Future Tasks section.

**Known issue recurrence from previous fork**
None. The job started without a previous fork summary.

**Code Architecture**


**Key Technical Concepts**
-   **Backend:** Flask (Python)
-   **Frontend:** React (JavaScript/JSX) with Vite
-   **Database:** MongoDB
-   **Architecture:** REST API serving a Single Page Application (SPA).
-   **Key Features:** Offline-first Progressive Web App (PWA), component-based UI, planned LLM integration for AI features.

**key DB schema**
The agent planned for and added indexes on the following new collections. The schemas are not yet defined in code but are implied by the features.
-   : { ... }
-   : { ... }
-   : { ... }
-   : { ... }
-   : { ... }

**changes in tech stack**
None. The existing stack of Flask, React, and MongoDB was used.

**All files of reference**
-   : The product requirements document, which was updated throughout the session.
-   : Modified to register all new backend route blueprints.
-   : Modified to add frontend routes for all new pages.
-   : Modified to add navigation links for all new modules.
-   : Modified to add Barcode and Signature field types.
-   **New P1 Files:** , , , , , .
-   **New P2 Files:** , , , .
-   **New P3 Files:** , , , , , .

**Areas that need refactoring**:
The current implementation consists of many placeholder pages and stubbed API endpoints. This is not technical debt but rather the initial scaffolding of the application. The primary task for the next agent is to build out the full functionality within this established structure, not to refactor it.

**key api endpoints**
-   , ,  (Existing, modified)
-    (New)
-   ,  (New)
-    (New)
-    (New)

**Critical Info for New Agent**
The user's last message provided a very detailed PRD checklist, which now serves as the single source of truth for all future work. Your primary task is to implement all features that the previous agent's gap analysis identified as Missing or Partial. You should follow the priority outlined in the All Pending/In progress Issue list section: start with the core data models, then the offline CAPI engine, and then flesh out all the feature modules. The existing code provides a solid skeleton for you to build upon.

**documents and test reports created in this job**
-   
-   
-   
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  ** (PENDING):** The user provided the full PRD and asked for a status check. This initiated the gap analysis.
2.  ** (PENDING):** This is the final and most important instruction. The next agent's entire goal is to fulfill this request.
3.  : User confirmation to continue.
4.  : User listing P3 features.
5.  : User confirmation to continue.
6.  : A slightly garbled message, interpreted as Proceed until we finish all the new features.
7.  : User confirmation to continue.

**Project Health Check:**
-   **Broken:** None. The application is running, and the fixes for the initial bugs were successful.
-   **Mocked:** Most new features are mocked or stubbed. The frontend pages display empty states, and the backend APIs return static success messages without implementing any business logic. The application is a functional skeleton but not a feature-complete product.

**3rd Party Integrations**
-   **OpenAI GPT-4o (or similar):** Planned for AI features. An  has been added to the  file, and the  library is installed. This uses the Emergent LLM Key.

**Testing status**
-   **Testing agent used after significant changes:** YES. Used after P1 and P2 implementation phases. It successfully identified two bugs that were subsequently fixed.
-   **Troubleshoot agent used after agent stuck in loop:** NO.
-   **Test files created:**
    -   
    -   
-   **Known regressions:** None.

**Credentials to test flow:**
Login is required to access the dashboard. The agent successfully used a login flow during its manual verification, but specific credentials were not documented.

**What agent forgot to execute**
The agent did not forget to execute any tasks. It was in the process of a multi-phase implementation when the user provided a comprehensive PRD and a new, overarching instruction to implement everything missing from it. The work is not forgotten but is now queued as the primary task for the next session.</analysis>
